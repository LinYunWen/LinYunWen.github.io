<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/linyunwen_icon/icon_32x32.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/linyunwen_icon/icon_32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/linyunwen_icon/icon_16x16.png">
  <link rel="mask-icon" href="/images/linyunwen_icon/icon_32x32.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"linyunwen.github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="ntpdintroduction12systemctl start ntpdsystemctl status ntpd  編輯 &#x2F;etc&#x2F;ntp.conf e.g.123456# 自己指定 NTP 伺服器server tock.stdtime.gov.twserver watch.stdtime.gov.twserver time.stdtime.gov.twserver clock.stdtim">
<meta property="og:type" content="article">
<meta property="og:title" content="ntpd">
<meta property="og:url" content="https://linyunwen.github.io/2021/10/24/ntpd/index.html">
<meta property="og:site_name" content="Lin Yunwen&#39;s Blog">
<meta property="og:description" content="ntpdintroduction12systemctl start ntpdsystemctl status ntpd  編輯 &#x2F;etc&#x2F;ntp.conf e.g.123456# 自己指定 NTP 伺服器server tock.stdtime.gov.twserver watch.stdtime.gov.twserver time.stdtime.gov.twserver clock.stdtim">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2021-10-24T00:54:49.000Z">
<meta property="article:modified_time" content="2021-11-07T01:25:37.087Z">
<meta property="article:author" content="Lin Yunwen">
<meta property="article:tag" content="note">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="ntp">
<meta property="article:tag" content="ntpd">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://linyunwen.github.io/2021/10/24/ntpd/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"https://linyunwen.github.io/2021/10/24/ntpd/","path":"2021/10/24/ntpd/","title":"ntpd"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ntpd | Lin Yunwen's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-H43D6184CW"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-H43D6184CW","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Lin Yunwen's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">keep moving forward</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ntpd"><span class="nav-number">1.</span> <span class="nav-text">ntpd</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#introduction"><span class="nav-number">1.1.</span> <span class="nav-text">introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#options"><span class="nav-number">1.2.</span> <span class="nav-text">options</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ntp-conf"><span class="nav-number">1.3.</span> <span class="nav-text">ntp.conf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reference"><span class="nav-number">1.4.</span> <span class="nav-text">reference</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lin Yunwen"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Lin Yunwen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">134</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">175</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/LinYunWen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LinYunWen" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:l40303k@gmail.com" title="E-Mail → mailto:l40303k@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="回到頂端">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://linyunwen.github.io/2021/10/24/ntpd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yunwen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lin Yunwen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ntpd
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2021-10-24 08:54:49" itemprop="dateCreated datePublished" datetime="2021-10-24T08:54:49+08:00">2021-10-24</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2021-11-07 09:25:37" itemprop="dateModified" datetime="2021-11-07T09:25:37+08:00">2021-11-07</time>
      </span>

  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>6.8k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>12 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="ntpd"><a href="#ntpd" class="headerlink" title="ntpd"></a>ntpd</h1><h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start ntpd</span><br><span class="line">systemctl status ntpd</span><br></pre></td></tr></table></figure>
<ul>
<li>編輯 <code>/etc/ntp.conf</code><ul>
<li>e.g.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 自己指定 NTP 伺服器</span><br><span class="line">server tock.stdtime.gov.tw</span><br><span class="line">server watch.stdtime.gov.tw</span><br><span class="line">server time.stdtime.gov.tw</span><br><span class="line">server clock.stdtime.gov.tw</span><br><span class="line">server tick.stdtime.gov.tw</span><br></pre></td></tr></table></figure>
<span id="more"></span></li>
</ul>
</li>
<li><code>ntpd [ -46aAbdDgLmnNqx ] [ -c conffile ] [ -f driftfile ] [ -i jaildir ] [ -I iface ] [ -k keyfile] [ -l logfile ] [ -p pidfile ] [ -P priority ] [ -r broadcastdelay ] [ -s statsdir] [ -t key ] [ -u user[:group] ] [ -U interface_update_interval ] [ -v variable] [ -V variable ]</code></li>
<li>Poll Interval Control<br>This version of NTP includes an intricate state machine to reduce the network load while maintaining a quality of synchronization consistent with the observed jitter and wander. There are a number of ways to tailor the operation in order enhance accuracy by reducing the interval or to reduce network overhead by increasing it. However, the user is advised to carefully consider the consequences of changing the poll adjustment range from the default minimum of 64 s to the default maximum of 1,024 s. The default minimum can be changed with the tinker minpoll command to a value not less than 16 s. This value is used for all configured associations, unless overridden by the minpoll option on the configuration command. Note that most device drivers will not operate properly if the poll interval is less than 64 s and that the broadcast server and manycast client associations will also use the default, unless overridden.</li>
</ul>
<p>In some cases involving dial up or toll services, it may be useful to increase the minimum interval to a few tens of minutes and maximum interval to a day or so. Under normal operation conditions, once the clock discipline loop has stabilized the interval will be increased in steps from the minimum to the maximum. However, this assumes the intrinsic clock frequency error is small enough for the discipline loop correct it. The capture range of the loop is 500 PPM at an interval of 64s decreasing by a factor of two for each doubling of interval. At a minimum of 1,024 s, for example, the capture range is only 31 PPM. If the intrinsic error is greater than this, the drift file ntp.drift will have to be specially tailored to reduce the residual error below this limit. Once this is done, the drift file is automatically updated once per hour and is available to initialize the frequency on subsequent daemon restarts.</p>
<h2 id="options"><a href="#options" class="headerlink" title="options"></a>options</h2><ul>
<li>-4<ul>
<li>Force DNS resolution of host names to the IPv4 namespace.</li>
</ul>
</li>
<li>-6<ul>
<li>Force DNS resolution of host names to the IPv6 namespace.</li>
</ul>
</li>
<li>-a<ul>
<li>Require cryptographic authentication for broadcast client, multicast client and symmetric passive associations. This is the default.</li>
</ul>
</li>
<li>-A<ul>
<li>Do not require cryptographic authentication for broadcast client, multicast client and symmetric passive associations. This is almost never a good idea.</li>
</ul>
</li>
<li>-b<ul>
<li>Enable the client to synchronize to broadcast servers.</li>
</ul>
</li>
<li>-c conffile<ul>
<li>Specify the name and path of the configuration file, default /etc/ntp.conf[char46]</li>
</ul>
</li>
<li>-d<ul>
<li>Specify debugging mode. This option may occur more than once, with each occurrence indicating greater detail of display.</li>
</ul>
</li>
<li>-D level<ul>
<li>Specify debugging level directly.</li>
</ul>
</li>
<li>-f driftfile<ul>
<li>Specify the name and path of the frequency file. This is the same operation as the driftfile driftfile configuration command.</li>
</ul>
</li>
<li>-g<ul>
<li>Normally, ntpd exits with a message to the system log if the offset exceeds the panic threshold, which is 1000 s by default. This option allows the time to be set to any value without restriction; however, this can happen only once. If the threshold is exceeded after that, ntpd will exit with a message to the system log. This option can be used with the -q and -x options. See the tinker command for other options.</li>
</ul>
</li>
<li>-i jaildir<ul>
<li>Chroot the server to the directory jaildir[char46] This option also implies that the server attempts to drop root privileges at startup (otherwise, chroot gives very little additional security), and it is only available if the OS supports to run the server without full root privileges. You may need to also specify a -u option.</li>
</ul>
</li>
<li>-I iface<ul>
<li>Listen on interface. This option may appear an unlimited number of times.</li>
</ul>
</li>
<li>-k keyfile<ul>
<li>Specify the name and path of the symmetric key file. This is the same operation as the keys keyfile configuration command.</li>
</ul>
</li>
<li>-l logfile<ul>
<li>Specify the name and path of the log file. The default is the system log file. This is the same operation as the logfile logfile configuration command.</li>
</ul>
</li>
<li>-L<ul>
<li>Do not listen to virtual IPs. The default is to listen.</li>
</ul>
</li>
<li>-m<ul>
<li>Lock memory.</li>
</ul>
</li>
<li>-n<ul>
<li>Don’t fork.</li>
</ul>
</li>
<li>-N<ul>
<li>To the extent permitted by the operating system, run the ntpd at the highest priority.</li>
</ul>
</li>
<li>-p pidfile<ul>
<li>Specify the name and path of the file used to record the ntpd process ID. This is the same operation as the pidfile pidfile configuration command.</li>
</ul>
</li>
<li>-P priority<ul>
<li>To the extent permitted by the operating system, run the ntpd at the specified priority.</li>
</ul>
</li>
<li>-q<ul>
<li>Exit the ntpd just after the first time the clock is set. This behavior mimics that of the ntpdate program, which is to be retired. The -g and -x options can be used with this option. Note: The kernel time discipline is disabled with this option.</li>
</ul>
</li>
<li>-r broadcastdelay<ul>
<li>Specify the default propagation delay from the broadcast/multicast server to this client. This is necessary only if the delay cannot be computed automatically by the protocol.</li>
</ul>
</li>
<li>-s statsdir<ul>
<li>Specify the directory path for files created by the statistics facility. This is the same operation as the statsdir statsdir configuration command.</li>
</ul>
</li>
<li>-t key<ul>
<li>Add a key number to the trusted key list. This option can occur more than once.</li>
</ul>
</li>
<li>-u user[:group]<ul>
<li>Specify a user, and optionally a group, to switch to. This option is only available if the OS supports to run the server without full root privileges. Currently, this option is supported under NetBSD (configure with –enable-clockctl) and Linux (configure with –enable-linuxcaps).</li>
</ul>
</li>
<li>-U interface update interval<ul>
<li>Number of seconds to wait between interface list scans to pick up new and delete network interface. Set to 0 to disable dynamic interface list updating. The default is to scan every 5 minutes.</li>
</ul>
</li>
<li>-v variable</li>
<li>-V variable<ul>
<li>Add a system variable listed by default.</li>
</ul>
</li>
<li>-x<ul>
<li>Normally, the time is slewed if the offset is less than the step threshold, which is 128 ms by default, and stepped if above the threshold. This option sets the threshold to 600 s, which is well within the accuracy window to set the clock manually. Note: Since the slew rate of typical Unix kernels is limited to 0.5 ms/s, each second of adjustment requires an amortization interval of 2000 s. Thus, an adjustment as much as 600 s will take almost 14 days to complete. This option can be used with the -g and -q options. See the tinker command for other options. Note: The kernel time discipline is disabled with this option.<h2 id="ntp-conf"><a href="#ntp-conf" class="headerlink" title="ntp.conf"></a>ntp.conf</h2></li>
</ul>
</li>
</ul>
<ul>
<li>The various modes are determined by the command keyword and the required IP address. Addresses are classed by type as (s) a remote server or peer (IPv4 class A, B and C), (b) the broadcast address of a local interface, (m) a multicast address (IPv4 class D), or (r) a reference clock address (127.127.x.x). The options that can be used with these commands are listed below.</li>
<li>server<ul>
<li>For type s and r addresses (only), this command normally mobilizes a persistent client mode association with the specified remote server or local reference clock. If the preempt flag is specified, a preemptable association is mobilized instead. In client mode the client clock can synchronize to the remote server or local reference clock, but the remote server can never be synchronized to the client clock. This command should NOT be used for type b or m addresses.</li>
</ul>
</li>
<li>peer<ul>
<li>For type s addresses (only), this command mobilizes a persistent symmetric-active mode association with the specified remote peer. In this mode the local clock can be synchronized to the remote peer or the remote peer can be synchronized to the local clock. This is useful in a network of servers where, depending on various failure scenarios, either the local or remote peer may be the better source of time. This command should NOT be used for type b, m or r addresses.<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://blog.gtwang.org/linux/linux-ntp-installation-and-configuration-tutorial/">Linux 設定 NTP 同步系統時間，自動網路校時教學 - G. T. Wang</a></li>
<li><a target="_blank" rel="noopener" href="https://linux.die.net/man/5/ntp.conf">ntp.conf(5): Server Options - Linux man page</a></li>
<li><a target="_blank" rel="noopener" href="https://linux.die.net/man/8/ntpd">ntpd(8): Network Time Protocol daemon - Linux man page</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/note/" rel="tag"># note</a>
              <a href="/tags/linux/" rel="tag"># linux</a>
              <a href="/tags/ntp/" rel="tag"># ntp</a>
              <a href="/tags/ntpd/" rel="tag"># ntpd</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/10/23/vim-plugin/" rel="prev" title="Vim Plugin">
                  <i class="fa fa-chevron-left"></i> Vim Plugin
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/10/24/ntpq/" rel="next" title="ntpq">
                  ntpq <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lin Yunwen</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>總字數：</span>
    <span title="總字數">339k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>所需總閱讀時間 &asymp;</span>
    <span title="所需總閱讀時間">10:16</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
